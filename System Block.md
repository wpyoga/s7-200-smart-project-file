# System Block

this block is similar across R01 R02 R03 versions

- 2 bytes:
  - 13 06: R03.01.00.00
  - 0F 06: R02.04.00.00
  - 0F 03: R01.00.00.00
- null block
  - 44 bytes null: R03.01.00.00
  - 44 bytes null: R02.04.00.00
  - 35 bytes null: R01.00.00.00
- 2 bytes: 00 01
- 1 byte: 02
- 1 byte: Modbus station number for Port0
- 3 bytes null
- 1 byte: baud rate
  - 01: 9600
  - 02: 19200
  - 04: 187500
- 8 bytes null
- 4 bytes unknown: 00 00 00 01
- 120 bytes: retentive ranges (from 0 to 5, 24 bytes each)
  - 4 bytes null
  - 4 bytes data width
    - 02 00 00 00: xB
    - 04 00 00 00: xW T
    - 08 00 00 00: xD C
  - 4 bytes memory location
    - 10 00 00 00 Vx
    - 20 00 00 00 Mx
    - 40 00 00 00 T
    - 80 00 00 00 C
  - 4 bytes offset
  - 4 bytes number of elements
- 1 byte version:
  - 06: R03.01.00.00
  - 05: R02.04.00.00
  - 03: R01.00.00.00
- 4 byte: CPU privileges
  - 01 00 00 00 full
  - 02 00 00 00 read
  - 03 00 00 00 minimum
  - 04 00 00 00 disallow upload
- 4 bytes: serial port security
  - allow cpu mode change without password
  - allow time of day reads and writes without password
  - 01 00 00 00: allow
  - 00 00 00 00: no allow
- hashed password or unknown data
  - 34 bytes: seems like hashed & salted password -> R03.01.00.00
    - 2 bytes: salt
    - SHA-256 of $password + $salt
  - 22 bytes: hashed & salted password -> R02.04.00.00
    - MD5 is 16 bytes
    - SHA1 is 20 bytes
    - maybe the salt is 2 bytes, with 20 bytes SHA1
  - 4 bytes: unknown -> R01.00.00.00
    - need V1.0 version software to test
    - might be a simple checksum
- 1 bytes: 01
- 1 byte: percentage of communications background time
  - default is 10% = 0a
- 3 bytes null
- 5 bytes
  - 1 byte:
    - 01: R03.01.00.00
    - 01: R02.04.00.00
  - 1 byte:
    - 00: R03.01.00.00
    - 01: R02.04.00.00
    - 00: R01.00.00.00
  - 3 bytes
    - startup mode ??? R03.01.00.00
    - startup mode: R02.04.00.00
      - 01 00 00: startup in RUN mode
      - 00 00 00: startup in STOP mode
      - 02 00 00: startup in LAST mode
    - unknown: R01.00.00.00
      - 00 00 00: unknown
- 4 bytes: allow missing hardware
  - 01 00 00 00 allow
  - 00 00 00 00 no allow
- 4 bytes: allow hardware configuration errors
  - 01 00 00 00 allow
  - 00 00 00 00 no allow
- 1 byte: 03
- 80 bytes IP address information
  - little endian
  - 4 bytes IP address status
    - fixed: 01 00 00 00
    - non fixed: 00 00 00 00
  - 4 bytes: 32-bit IP address -> 01 02 a8 c0 = 1 2 168 192 -> 192.168.2.1
  - 4 bytes: 32-bit netmask
  - 4 bytes: 32-bit gateway
  - 64 bytes: station name including trailing null
- 16 bytes null
- CPU configuration
  - only on R02.04.00.00 & R03.01.00.00
    - 1 byte null
    - 12 bytes
      - 4 bytes restrict communication writes
        - 01 00 00 00 restrict
        - 00 00 00 00 no restrict
      - 4 bytes allowed range V memory offset
      - 4 bytes number of bytes
  - 2 bytes CPU type
    - 1 byte
      - 00 for ST
      - 01 for SR
      - 81 for CR..s
      - 20 for ST32
    - 1 bytes
      - 02 for xx20
      - 03 for xx30 & ST32
      - 04 for xx40
      - 06 for xx60
  - 1 byte null
  - 4 bytes:
    - 80 07 01 00: R03.01.00.00
    - 80 06 01 00: R02.04.00.00
  - 30 bytes null
  - 2 bytes PLC type
    - 1 byte plc type
      - 00 for ST
      - 01 for SR
      - 20 for ST32
      - 81: for CR..s
    - 1 byte
      - 02 for xx20
      - 03 for xx30 and ST32
      - 04 for xx40
      - 06 for xx60
  - 1 byte null
  - 3 bytes: 80 01 00
  - 6 bytes null
  - PLC version string
    - only on R02.04.00.00 & R03.01.00.00
    - missing on R01.00.00.00
    - 1 byte length
    - PLC firmware version? V02.05.01_00.00.01.00 / V03.01.00_00.00.00.00
      - sometimes there is a null byte following
      - if there is a null byte following, the previous length becomes 16 (24 dec)
  - 24 bytes unknown, only on R03.01.00.00
    - 8 bytes x 2 unknown: 00 00 00 00 0a 00 00 00
    - 8 bytes null
  - 6 bytes: 01 01 00 00 00 00
- some data
  - only on R01.00.00.00
  - 1 byte null
  - 8 bytes unknown (null?)
  - 4 bytes: 64 00 00 00
  - 4 bytes null
  - 4 bytes: 03 00 00 00
  - 32 bytes null
  - 2 bytes: 00 01
- cpu digital input config
  - only on R02.04.00.00 & R03.01.00.00
  - missing on R01.00.00.00
  - 1 byte type: 02
  - 2 bytes length
    - length = number of entries = number of inputs
    - SR20 = 12 = 0c 00
    - SR30 = 18 = 12 00
    - SR40 = 24 = 18 00
    - SR60 = 36 = 24 00
    - ST32 = 16 = 10 00
  - 2 bytes null
  - n x2 bytes CPU digital input configuration
    - starting from I0.0
    - 1 byte null
    - 1 byte bitfield
      - bit 7 = filter ms or us
        - 0 = ms
        - 1 = us
      - bit 6 = pulse catch
      - bits 5-0 = digital input filter
        - e (hex) = None
        - 9 = 12.8 ms or us
        - 7 = 6.4 ms or us
        - 6 = 3.2 ms or us
        - 5 = 1.6 ms or us
        - 4 = 0.8 ms or us
        - 3 = 0.4 ms or us
        - 2 = 0.2 ms or us
- cpu digital output config
  - only on R02.04.00.00 & R03.01.00.00
  - missing on R01.00.00.00
  - 1 byte: 01
  - 1 byte: freeze outputs in last state
    - 01: freeze
    - 00: no freeze
  - 3 bytes null
  - 1 byte type: 01
  - subrecord: CPU output status in STOP mode
    - 2 bytes length
      - 08 00: xx20 with 8 outputs -> 8 records
      - 0C 00: xx30 with 12 outputs -> 16 records (4 unused)
      - 10 00: xx40 or ST32 with 16 outputs -> 16 records
      - 18 00: xx60 with 24 outputs -> 24 records
    - n x4 bytes records
      - starting from Q0.0
      - if freeze outputs in last state is enabled, all data here is null
      - 00 00 00 01: output ON in stop mode
      - 00 00 00 00: output OFF in stop mode
  - 2 bytes null
- signal board
  - [Signal Board](Signal%20Board.md) described here
  - version 06:
    - 4 bytes: number of signal boards
      - 02 00 00 00 for ST32
    - signal board 1
    - signal board 2
  - version 05:
    - signal board
- expansion modules
  - [Expansion Module](Expansion%20Module.md) described here
  - 4 bytes: number of expansion modules supported
    - 10 00 00 00 for ST32
    - 08 00 00 00 for V3.0 ??? -> TODO: verify
    - 06 00 00 00 for v2.x
    - 04 00 00 00 for v1.x
  - n records of expansion modules
- some records
  - R02.04.00.00 & R03.01.00.00
    - 2 bytes length: 04 00
    - 4x 8 bytes
    - 2 bytes null
  - R01.00.00.00
    - 2 bytes length: 03 00
    - 3x 8 bytes (null?)
    - 2 bytes null
- additional settings on R03.01.00.00
  - 14 bytes unknown
    - 1 byte bit field
      - 01 unknown
      - 02 HMI secure communication
    - 4 bytes null
    - 1 byte: enable PUT/GET service
      - 00: disable
      - 01: enable
    - 3 bytes null
    - 1 byte unknown: 01
    - 3 bytes null
    - 1 byte 1e
  - n x 4 bytes: variable records
    - 2 bytes length, sometimes 00 00 or 02 00
    - n x 4 bytes data (usually null)
    - 2 bytes null
